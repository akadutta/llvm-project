; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc < %s -mtriple=sparcv9 | FileCheck %s -check-prefix=V9
; RUN: llc < %s -mtriple=sparcv9 -mattr=popc | FileCheck %s -check-prefix=POPC
; RUN: llc < %s -mtriple=sparcv9 -mattr=vis3 | FileCheck %s -check-prefix=VIS3

;; FIXME the V9 versions should be a libcall.

define i32 @i32_nopoison(i32 %x) nounwind {
; V9-LABEL: i32_nopoison:
; V9:       ! %bb.0:
; V9-NEXT:    cmp %o0, 0
; V9-NEXT:    be %icc, .LBB0_2
; V9-NEXT:    nop
; V9-NEXT:  ! %bb.1: ! %cond.false
; V9-NEXT:    sub %g0, %o0, %o1
; V9-NEXT:    and %o0, %o1, %o0
; V9-NEXT:    sethi 122669, %o1
; V9-NEXT:    or %o1, 305, %o1
; V9-NEXT:    mulx %o0, %o1, %o0
; V9-NEXT:    srl %o0, 27, %o0
; V9-NEXT:    srl %o0, 0, %o0
; V9-NEXT:    sethi %h44(.LCPI0_0), %o1
; V9-NEXT:    add %o1, %m44(.LCPI0_0), %o1
; V9-NEXT:    sllx %o1, 12, %o1
; V9-NEXT:    add %o1, %l44(.LCPI0_0), %o1
; V9-NEXT:    retl
; V9-NEXT:    ldub [%o1+%o0], %o0
; V9-NEXT:  .LBB0_2:
; V9-NEXT:    retl
; V9-NEXT:    mov 32, %o0
;
; POPC-LABEL: i32_nopoison:
; POPC:       ! %bb.0:
; POPC-NEXT:    cmp %o0, 0
; POPC-NEXT:    be %icc, .LBB0_2
; POPC-NEXT:    nop
; POPC-NEXT:  ! %bb.1: ! %cond.false
; POPC-NEXT:    add %o0, -1, %o1
; POPC-NEXT:    andn %o1, %o0, %o0
; POPC-NEXT:    srl %o0, 0, %o0
; POPC-NEXT:    retl
; POPC-NEXT:    popc %o0, %o0
; POPC-NEXT:  .LBB0_2:
; POPC-NEXT:    retl
; POPC-NEXT:    mov 32, %o0
;
; VIS3-LABEL: i32_nopoison:
; VIS3:       ! %bb.0:
; VIS3-NEXT:    cmp %o0, 0
; VIS3-NEXT:    be %icc, .LBB0_2
; VIS3-NEXT:    nop
; VIS3-NEXT:  ! %bb.1: ! %cond.false
; VIS3-NEXT:    add %o0, -1, %o1
; VIS3-NEXT:    andn %o1, %o0, %o0
; VIS3-NEXT:    lzcnt %o0, %o0
; VIS3-NEXT:    mov 64, %o1
; VIS3-NEXT:    retl
; VIS3-NEXT:    sub %o1, %o0, %o0
; VIS3-NEXT:  .LBB0_2:
; VIS3-NEXT:    retl
; VIS3-NEXT:    mov 32, %o0
  %ret = call i32 @llvm.cttz.i32(i32 %x, i1 false)
  ret i32 %ret
}

define i32 @i32_poison(i32 %x) nounwind {
; V9-LABEL: i32_poison:
; V9:       ! %bb.0:
; V9-NEXT:    sub %g0, %o0, %o1
; V9-NEXT:    and %o0, %o1, %o0
; V9-NEXT:    sethi 122669, %o1
; V9-NEXT:    or %o1, 305, %o1
; V9-NEXT:    mulx %o0, %o1, %o0
; V9-NEXT:    srl %o0, 27, %o0
; V9-NEXT:    srl %o0, 0, %o0
; V9-NEXT:    sethi %h44(.LCPI1_0), %o1
; V9-NEXT:    add %o1, %m44(.LCPI1_0), %o1
; V9-NEXT:    sllx %o1, 12, %o1
; V9-NEXT:    add %o1, %l44(.LCPI1_0), %o1
; V9-NEXT:    retl
; V9-NEXT:    ldub [%o1+%o0], %o0
;
; POPC-LABEL: i32_poison:
; POPC:       ! %bb.0:
; POPC-NEXT:    add %o0, -1, %o1
; POPC-NEXT:    andn %o1, %o0, %o0
; POPC-NEXT:    srl %o0, 0, %o0
; POPC-NEXT:    retl
; POPC-NEXT:    popc %o0, %o0
;
; VIS3-LABEL: i32_poison:
; VIS3:       ! %bb.0:
; VIS3-NEXT:    add %o0, -1, %o1
; VIS3-NEXT:    andn %o1, %o0, %o0
; VIS3-NEXT:    lzcnt %o0, %o0
; VIS3-NEXT:    mov 64, %o1
; VIS3-NEXT:    retl
; VIS3-NEXT:    sub %o1, %o0, %o0
  %ret = call i32 @llvm.cttz.i32(i32 %x, i1 true)
  ret i32 %ret
}

define i64 @i64_nopoison(i64 %x) nounwind {
; V9-LABEL: i64_nopoison:
; V9:       ! %bb.0:
; V9-NEXT:    brz %o0, .LBB2_2
; V9-NEXT:    nop
; V9-NEXT:  ! %bb.1: ! %cond.false
; V9-NEXT:    sub %g0, %o0, %o1
; V9-NEXT:    and %o0, %o1, %o0
; V9-NEXT:    sethi 3362647, %o1
; V9-NEXT:    or %o1, 447, %o1
; V9-NEXT:    sethi 34344, %o2
; V9-NEXT:    or %o2, 914, %o2
; V9-NEXT:    sllx %o2, 32, %o2
; V9-NEXT:    or %o2, %o1, %o1
; V9-NEXT:    mulx %o0, %o1, %o0
; V9-NEXT:    srlx %o0, 58, %o0
; V9-NEXT:    sethi %h44(.LCPI2_0), %o1
; V9-NEXT:    add %o1, %m44(.LCPI2_0), %o1
; V9-NEXT:    sllx %o1, 12, %o1
; V9-NEXT:    add %o1, %l44(.LCPI2_0), %o1
; V9-NEXT:    retl
; V9-NEXT:    ldub [%o1+%o0], %o0
; V9-NEXT:  .LBB2_2:
; V9-NEXT:    retl
; V9-NEXT:    mov 64, %o0
;
; POPC-LABEL: i64_nopoison:
; POPC:       ! %bb.0:
; POPC-NEXT:    brz %o0, .LBB2_2
; POPC-NEXT:    nop
; POPC-NEXT:  ! %bb.1: ! %cond.false
; POPC-NEXT:    add %o0, -1, %o1
; POPC-NEXT:    andn %o1, %o0, %o0
; POPC-NEXT:    retl
; POPC-NEXT:    popc %o0, %o0
; POPC-NEXT:  .LBB2_2:
; POPC-NEXT:    retl
; POPC-NEXT:    mov 64, %o0
;
; VIS3-LABEL: i64_nopoison:
; VIS3:       ! %bb.0:
; VIS3-NEXT:    brz %o0, .LBB2_2
; VIS3-NEXT:    nop
; VIS3-NEXT:  ! %bb.1: ! %cond.false
; VIS3-NEXT:    add %o0, -1, %o1
; VIS3-NEXT:    andn %o1, %o0, %o0
; VIS3-NEXT:    lzcnt %o0, %o0
; VIS3-NEXT:    mov 64, %o1
; VIS3-NEXT:    retl
; VIS3-NEXT:    sub %o1, %o0, %o0
; VIS3-NEXT:  .LBB2_2:
; VIS3-NEXT:    retl
; VIS3-NEXT:    mov 64, %o0
  %ret = call i64 @llvm.cttz.i64(i64 %x, i1 false)
  ret i64 %ret
}

define i64 @i64_poison(i64 %x) nounwind {
; V9-LABEL: i64_poison:
; V9:       ! %bb.0:
; V9-NEXT:    sub %g0, %o0, %o1
; V9-NEXT:    and %o0, %o1, %o0
; V9-NEXT:    sethi 3362647, %o1
; V9-NEXT:    or %o1, 447, %o1
; V9-NEXT:    sethi 34344, %o2
; V9-NEXT:    or %o2, 914, %o2
; V9-NEXT:    sllx %o2, 32, %o2
; V9-NEXT:    or %o2, %o1, %o1
; V9-NEXT:    mulx %o0, %o1, %o0
; V9-NEXT:    srlx %o0, 58, %o0
; V9-NEXT:    sethi %h44(.LCPI3_0), %o1
; V9-NEXT:    add %o1, %m44(.LCPI3_0), %o1
; V9-NEXT:    sllx %o1, 12, %o1
; V9-NEXT:    add %o1, %l44(.LCPI3_0), %o1
; V9-NEXT:    retl
; V9-NEXT:    ldub [%o1+%o0], %o0
;
; POPC-LABEL: i64_poison:
; POPC:       ! %bb.0:
; POPC-NEXT:    add %o0, -1, %o1
; POPC-NEXT:    andn %o1, %o0, %o0
; POPC-NEXT:    retl
; POPC-NEXT:    popc %o0, %o0
;
; VIS3-LABEL: i64_poison:
; VIS3:       ! %bb.0:
; VIS3-NEXT:    add %o0, -1, %o1
; VIS3-NEXT:    andn %o1, %o0, %o0
; VIS3-NEXT:    lzcnt %o0, %o0
; VIS3-NEXT:    mov 64, %o1
; VIS3-NEXT:    retl
; VIS3-NEXT:    sub %o1, %o0, %o0
  %ret = call i64 @llvm.cttz.i64(i64 %x, i1 true)
  ret i64 %ret
}
